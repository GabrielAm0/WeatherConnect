{"version":3,"file":"react-lenis.umd.js","sources":["../src/index.jsx"],"sourcesContent":["'use client'\r\n\r\nimport { useFrame } from '@studio-freight/hamo'\r\nimport Lenis from '@studio-freight/lenis'\r\nimport cn from 'clsx'\r\nimport PropTypes from 'prop-types' // ES6\r\nimport React, {\r\n  createContext,\r\n  forwardRef,\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useImperativeHandle,\r\n  useRef,\r\n  useState,\r\n} from 'react'\r\nimport { create } from 'zustand'\r\n\r\nexport const LenisContext = createContext()\r\n\r\nconst useRoot = create(() => ({}))\r\n\r\nfunction useCurrentLenis() {\r\n  const local = useContext(LenisContext)\r\n  const root = useRoot()\r\n\r\n  return local ?? root\r\n}\r\n\r\n/**\r\n * @param {CallbackFunction} [callback] Callback to be called on scroll\r\n * @param {Array=} [deps=[]] Dependencies for callback\r\n * @param {number=} [priority=0] Priority of callback (lower priority callbacks are called first)\r\n *\r\n * @returns {LenisInstance} Lenis instance\r\n */\r\nexport function useLenis(callback, deps = [], priority = 0) {\r\n  const { lenis, addCallback, removeCallback } = useCurrentLenis()\r\n\r\n  useEffect(() => {\r\n    if (!callback || !addCallback || !removeCallback || !lenis) return\r\n\r\n    addCallback(callback, priority)\r\n    callback(lenis)\r\n\r\n    return () => {\r\n      removeCallback(callback)\r\n    }\r\n  }, [lenis, addCallback, removeCallback, priority, ...deps])\r\n\r\n  return lenis\r\n}\r\n\r\n/**\r\n * @param {boolean=} [root] Whether Lenis will be initialized on document.documentElement\r\n * @param {ReactLenisOptions} [options={}] Lenis options {@link ReactLenisOptions}\r\n * @param {boolean=} [autoRaf=true] Whether to call Lenis.raf automatically on every frame\r\n * @param {number=} [rafPriority=0] Priority of Lenis.raf call (lower priority callbacks are called first)\r\n * @param {string=} [className] Class name to be applied to the wrapper\r\n */\r\nconst ReactLenis = forwardRef(\r\n  (\r\n    {\r\n      children,\r\n      root = false,\r\n      options = {},\r\n      autoRaf = true,\r\n      rafPriority = 0,\r\n      className,\r\n      ...props\r\n    },\r\n    ref\r\n  ) => {\r\n    const wrapperRef = useRef()\r\n    const contentRef = useRef()\r\n\r\n    const [lenis, setLenis] = useState()\r\n\r\n    const callbacksRefs = useRef([])\r\n\r\n    const addCallback = useCallback((callback, priority) => {\r\n      callbacksRefs.current.push({ callback, priority })\r\n      callbacksRefs.current.sort((a, b) => a.priority - b.priority)\r\n    }, [])\r\n\r\n    const removeCallback = useCallback((callback) => {\r\n      callbacksRefs.current = callbacksRefs.current.filter(\r\n        (cb) => cb.callback !== callback\r\n      )\r\n    }, [])\r\n\r\n    useImperativeHandle(\r\n      ref,\r\n      () => ({\r\n        wrapper: wrapperRef.current,\r\n        content: contentRef.current,\r\n        lenis,\r\n      }),\r\n      [lenis]\r\n    )\r\n\r\n    useEffect(() => {\r\n      const lenis = new Lenis({\r\n        ...options,\r\n        ...(!root && {\r\n          wrapper: wrapperRef.current,\r\n          content: contentRef.current,\r\n        }),\r\n      })\r\n\r\n      setLenis(lenis)\r\n\r\n      return () => {\r\n        lenis.destroy()\r\n        setLenis(undefined)\r\n      }\r\n    }, [root, JSON.stringify(options)])\r\n\r\n    useFrame((time) => {\r\n      if (autoRaf) {\r\n        lenis?.raf(time)\r\n      }\r\n    }, rafPriority)\r\n\r\n    useEffect(() => {\r\n      if (root && lenis) {\r\n        useRoot.setState({ lenis, addCallback, removeCallback })\r\n      }\r\n    }, [root, lenis, addCallback, removeCallback])\r\n\r\n    const onScroll = useCallback((e) => {\r\n      for (let i = 0; i < callbacksRefs.current.length; i++) {\r\n        callbacksRefs.current[i].callback(e)\r\n      }\r\n    }, [])\r\n\r\n    useEffect(() => {\r\n      lenis?.on('scroll', onScroll)\r\n\r\n      return () => {\r\n        lenis?.off('scroll', onScroll)\r\n      }\r\n    }, [lenis, onScroll])\r\n\r\n    const onClassNameChange = useCallback(() => {\r\n      if (wrapperRef.current)\r\n        wrapperRef.current.className = cn(lenis?.className, className)\r\n    }, [lenis, className])\r\n\r\n    useEffect(() => {\r\n      onClassNameChange()\r\n\r\n      lenis?.on('className change', onClassNameChange)\r\n\r\n      return () => {\r\n        lenis?.off('className change', onClassNameChange)\r\n      }\r\n    }, [lenis, onClassNameChange])\r\n\r\n    return (\r\n      <LenisContext.Provider value={{ lenis, addCallback, removeCallback }}>\r\n        {root ? (\r\n          children\r\n        ) : (\r\n          <div\r\n            ref={wrapperRef}\r\n            className={cn(lenis?.className, className)}\r\n            {...props}\r\n          >\r\n            <div ref={contentRef}>{children}</div>\r\n          </div>\r\n        )}\r\n      </LenisContext.Provider>\r\n    )\r\n  }\r\n)\r\nReactLenis.displayName = 'ReactLenis'\r\n\r\nReactLenis.propTypes = {\r\n  children: PropTypes.node,\r\n  root: PropTypes.bool,\r\n  options: PropTypes.object,\r\n  autoRaf: PropTypes.bool,\r\n  rafPriority: PropTypes.number,\r\n  className: PropTypes.string,\r\n}\r\n\r\nexport { ReactLenis as Lenis, ReactLenis }\r\nexport default ReactLenis\r\n\r\n/**\r\n * @callback EasingFunction\r\n * @param {number} rawValue\r\n * @returns {number} eased output value\r\n */\r\n\r\n/**\r\n * @callback CallbackFunction\r\n * @param {LenisInstance} instance\r\n */\r\n\r\n/**\r\n * @typedef {Object} CallbackEvents\r\n * @property {CallbackFunction[]} scroll scroll events\r\n */\r\n\r\n/**\r\n * @callback RAF\r\n * @param {number} time\r\n */\r\n\r\n/**\r\n * @typedef {Object} ScrollToParams\r\n * @property {number} [offset] equivalent to scroll-padding-top\r\n * @property {number} [lerp] animation interpolation rate\r\n * @property {number} [duration] animation duration (in seconds)\r\n * @property {EasingFunction} [easing] animation easing\r\n * @property {boolean} [immediate] ignore duration, easing and lerp\r\n * @property {boolean} [lock] whether or not to prevent the user from scrolling until the target is reached\r\n * @property {boolean} [force] reach target even if instance is stopped\r\n * @property {CallbackFunction} [onComplete] called when the target is reached\r\n */\r\n\r\n/**\r\n * @callback ScrollTo\r\n * @param {number|string|HTMLElement} target\r\n * @param {ScrollToParams} [options]\r\n */\r\n\r\n/**\r\n * @typedef {Object} ReactLenisOptions\r\n * @property {(HTMLElement|Window)} [wrapper=window] interpolation rate\r\n * @property {HTMLElement=} [content=document.documentElement]\r\n * @property {(HTMLElement|Window)} [wheelEventsTarget=wrapper]\r\n * @property {number=} [lerp=0.1] interpolation rate\r\n * @property {number=} [duration=1.2] scroll duration\r\n * @property {EasingFunction=} [easing=(t) => Math.min(1, 1.001 - Math.pow(2, -10 * t))] // easing function to apply to scroll values\r\n * @property {string=} [orientation='vertical'] scroll orientation\r\n * @property {string=} [gestureOrientation='vertical']\r\n * @property {boolean=} [smoothWheel=true]\r\n * @property {boolean=} [smoothTouch=false]\r\n * @property {boolean=} [syncTouch=false]\r\n * @property {number=} [syncTouchLerp=0.1]\r\n * @property {number=} [touchInertiaMultiplier=1]\r\n * @property {boolean=} [normalizeWheel=false]\r\n * @property {boolean=} [infinite=false] enable infinite scroll\r\n * @property {boolean=} [autoResize=true]\r\n */\r\n\r\n/**\r\n * @typedef {Object} Dimensions\r\n * @property {(HTMLElement|Window)} wrapper Wrapper lenis is applied to\r\n * @property {HTMLElement} content\r\n * @property {ResizeObserver} contentResizeObserver\r\n * @property {function():void} resize\r\n * @property {function():void} onContentResize\r\n * @property {function():void} onWrapperResize\r\n * @property {number} width viewport width\r\n * @property {number} height viewport height\r\n * @property {number} scrollWidth\r\n * @property {number} scrollHeight\r\n */\r\n\r\n/**\r\n * @typedef {Object} Emitter\r\n * @property {CallbackEvents} events\r\n */\r\n\r\n/**\r\n * @callback EventHandler\r\n * @param {string} id lenis instance event\r\n * @param {CallbackFunction} fn callback\r\n */\r\n\r\n/**\r\n * @typedef {Object} LenisInstance\r\n * @property {number} animatedScroll Current scroll value\r\n * @property {Dimensions} dimensions Dimensions instance\r\n * @property {number} direction scroll direction; 0: stopped, 1: scrolling up, -1: scrolling down\r\n * @property {Emitter} emitter Emitter instance\r\n * @property {ReactLenisOptions} options Instance options {@link ReactLenisOptions}\r\n * @property {number} targetScroll Target scroll value\r\n * @property {number} time Time elapsed since instance creation\r\n * @property {number} actualScroll Current scroll value registered by the browser\r\n * @property {number} velocity Current scroll velocity\r\n * @property {boolean} isHorizontal Whether or not the instance is horizontal\r\n * @property {boolean} isScrolling Whether or not the instance is being animated\r\n * @property {boolean} isSmooth Whether or not the instance is animated\r\n * @property {boolean} isStopped Whether or not the user should be able to scroll\r\n * @property {number} limit Maximum scroll value\r\n * @property {number} progress Scroll progress from 0 to 1\r\n * @property {HTMLElement} rootElement Element on which Lenis is instanced\r\n * @property {number} scroll Current scroll value (handles infinite scroll if activated)\r\n * @property {function():void} stop Pauses the scroll\r\n * @property {function():void} start Resumes the scroll\r\n * @property {function():void} resize Compute internal sizes, has to be used if autoResize option is false\r\n * @property {function():void} destroy Destroys the instance and removes all events\r\n * @property {EventHandler} on Lenis event listener\r\n * @property {ScrollTo} scrollTo Scroll to target\r\n * @property {RAF} raf Must be called every frame for internal usage\r\n */\r\n"],"names":["LenisContext","createContext","useRoot","create","ReactLenis","forwardRef","children","root","options","autoRaf","rafPriority","className","props","ref","wrapperRef","useRef","contentRef","lenis","setLenis","useState","callbacksRefs","addCallback","useCallback","callback","priority","current","push","sort","a","b","removeCallback","filter","cb","useImperativeHandle","wrapper","content","useEffect","Lenis","destroy","undefined","JSON","stringify","useFrame","time","raf","setState","onScroll","e","i","length","on","off","onClassNameChange","cn","React","createElement","Provider","value","_extends","displayName","propTypes","PropTypes","node","bool","object","number","string","deps","local","useContext","useCurrentLenis"],"mappings":"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"}